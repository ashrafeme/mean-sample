angular.module("app",["ngRoute"]),angular.module("app").controller("ApplicationCtrl",["$scope",function(t){t.$on("login",function(o,n){t.currentUser=n})}]),angular.module("app").controller("LoginCtrl",["$scope","UserSvc",function(t,o){t.login=function(n,e){o.login(n,e).then(function(o){t.$emit("login",o.data)})}}]),angular.module("app").controller("PostsCtrl",["$scope","PostSvc",function(t,o){o.fetch().success(function(o){t.posts=o}),t.addPost=function(){t.postBody&&o.create({body:t.postBody}).success(function(o){t.postBody=null})},t.$on("ws:new_post",function(o,n){t.$apply(function(){t.posts.unshift(n)})})}]),angular.module("app").service("PostSvc",["$http",function(t){this.fetch=function(){return t.get("/api/posts")},this.create=function(o){return t.post("/api/posts",o)}}]),angular.module("app").controller("RegisterCtrl",["$scope","UserSvc","$location",function(t,o,n){t.register=function(e,r){o.register(e,r).then(function(o){t.$emit("login",o),n.path("/")})}}]),angular.module("app").config(["$routeProvider",function(t){t.when("/",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"})}]),angular.module("app").service("UserSvc",["$http",function(t){var o=this;o.getUser=function(){return t.get("/api/users",{headers:{"X-Auth":this.token}})},o.login=function(n,e){return t.post("/api/sessions",{username:n,password:e}).then(function(n){return o.token=n.data,t.defaults.headers.common["X-Auth"]=n.data,o.getUser()})},o.register=function(n,e){return t.post("/api/users",{username:n,password:e}).then(function(){return o.login(n,e)})}}]),angular.module("app").run(["$rootScope","$window","$timeout",function(t,o,n){!function e(){var r;r="https:"===o.location.protocol?"wss://"+o.location.host:"ws://"+o.location.host;var s=new WebSocket(r);s.onclose=function(t){console.log("WebSocket closed,Reconnecting...."),n(e,1e4)},s.onmessage=function(o){console.log(o);var n=JSON.parse(o.data);t.$broadcast("ws:"+n.topic,n.data)}}()}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uLmN0cmwuanMiLCJsb2dpbi5jdHJsLmpzIiwicG9zdHMuY3RybC5qcyIsInBvc3RzLnN2Yy5qcyIsInJlZ2lzdGVyLmN0cmwuanMiLCJyb3V0ZXMuanMiLCJ1c2VyLnN2Yy5qcyIsIndlYnNvY2tldHMuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCIkb24iLCJfIiwidXNlciIsImN1cnJlbnRVc2VyIiwiVXNlclN2YyIsImxvZ2luIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInRoZW4iLCJyZXNwb25zZSIsIiRlbWl0IiwiZGF0YSIsIlBvc3RTdmMiLCJmZXRjaCIsInN1Y2Nlc3MiLCJwb3N0cyIsImFkZFBvc3QiLCJwb3N0Qm9keSIsImNyZWF0ZSIsImJvZHkiLCJwb3N0IiwiJGFwcGx5IiwidW5zaGlmdCIsInNlcnZpY2UiLCIkaHR0cCIsInRoaXMiLCJnZXQiLCIkbG9jYXRpb24iLCJyZWdpc3RlciIsInBhdGgiLCJjb25maWciLCIkcm91dGVQcm92aWRlciIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsInN2YyIsImdldFVzZXIiLCJoZWFkZXJzIiwiWC1BdXRoIiwidG9rZW4iLCJ2YWwiLCJkZWZhdWx0cyIsImNvbW1vbiIsInJ1biIsIiRyb290U2NvcGUiLCIkd2luZG93IiwiJHRpbWVvdXQiLCJjb25uZWN0IiwiaG9zdCIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJjb25uZWN0aW9uIiwiV2ViU29ja2V0Iiwib25jbG9zZSIsImUiLCJjb25zb2xlIiwibG9nIiwib25tZXNzYWdlIiwicGF5bG9hZCIsIkpTT04iLCJwYXJzZSIsIiRicm9hZGNhc3QiLCJ0b3BpYyJdLCJtYXBwaW5ncyI6IkFBQUFBLFFBQUFDLE9BQUEsT0FDQSxZQ0RBRCxRQUFBQyxPQUFBLE9BQ0FDLFdBQUEsbUJBQUEsU0FBQSxTQUFBQyxHQUNBQSxFQUFBQyxJQUFBLFFBQUEsU0FBQUMsRUFB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Z1JvdXRlJ1xuICAgIF0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uY29udHJvbGxlcihcIkFwcGxpY2F0aW9uQ3RybFwiLGZ1bmN0aW9uKCRzY29wZSl7XG4gICAgJHNjb3BlLiRvbignbG9naW4nLGZ1bmN0aW9uKF8sdXNlcikge1xuICAgICAgICAkc2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuICAgIH0pO1xufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uY29udHJvbGxlcihcIkxvZ2luQ3RybFwiLGZ1bmN0aW9uKCRzY29wZSxVc2VyU3ZjKXtcbiAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSxwYXNzd29yZCl7XG4gICAgICAgIFVzZXJTdmMubG9naW4odXNlcm5hbWUscGFzc3dvcmQpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAkc2NvcGUuJGVtaXQoXCJsb2dpblwiLHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICB9KTtcbiAgICB9XG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5jb250cm9sbGVyKFwiUG9zdHNDdHJsXCIsZnVuY3Rpb24oJHNjb3BlLFBvc3RTdmMpe1xuICAgICAgICAgICAgUG9zdFN2Yy5mZXRjaCgpXG4gICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihwb3N0cyl7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5wb3N0cz1wb3N0czsgICBcbiAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gYWRkIHBvc3QgdG8gcG9zdHMgbGlzdCAgICBcbiAgICAgICAgICAgICRzY29wZS5hZGRQb3N0PWZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgLy8gb25seSBhZGQgcG9zdCBpZiBpdCBoYXMgcG9zdGJvZHlcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUucG9zdEJvZHkpe1xuICAgICAgICAgICAgICAgICAgICBQb3N0U3ZjLmNyZWF0ZSh7Ym9keTokc2NvcGUucG9zdEJvZHl9KVxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihwb3N0KXtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vJHNjb3BlLnBvc3RzLnVuc2hpZnQocG9zdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucG9zdEJvZHkgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IFxuICAgICAgICAgICAgXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCd3czpuZXdfcG9zdCcsZnVuY3Rpb24gKF8scG9zdCkge1xuICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBvc3RzLnVuc2hpZnQocG9zdCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgfSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uc2VydmljZSgnUG9zdFN2YycsZnVuY3Rpb24oJGh0dHApe1xuICAgIFxuICAgIHRoaXMuZmV0Y2ggPSBmdW5jdGlvbigpe1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuICRodHRwLmdldChcIi9hcGkvcG9zdHNcIilcbiAgICB9XG4gICAgXG4gICAgdGhpcy5jcmVhdGUgPSBmdW5jdGlvbihwb3N0KXtcbiAgICAgIHJldHVybiAgJGh0dHAucG9zdChcIi9hcGkvcG9zdHNcIixwb3N0KTtcbiAgICB9XG59KTsgICAgIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uY29udHJvbGxlcignUmVnaXN0ZXJDdHJsJywgZnVuY3Rpb24gKCRzY29wZSwgVXNlclN2YywgJGxvY2F0aW9uKSB7XG4gICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICBVc2VyU3ZjLnJlZ2lzdGVyKHVzZXJuYW1lLCBwYXNzd29yZClcbiAgICAudGhlbihmdW5jdGlvbiAodXNlcikge1xuICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicsIHVzZXIpXG4gICAgICAkbG9jYXRpb24ucGF0aCgnLycpXG4gICAgfSlcbiAgfVxufSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5jb25maWcoZnVuY3Rpb24oJHJvdXRlUHJvdmlkZXIpe1xuICAgICRyb3V0ZVByb3ZpZGVyXG4gICAgLndoZW4oJy8nLHtjb250cm9sbGVyOidQb3N0c0N0cmwnLHRlbXBsYXRlVXJsOidwb3N0cy5odG1sJ30pXG4gICAgLndoZW4oJy9yZWdpc3Rlcicse2NvbnRyb2xsZXI6J1JlZ2lzdGVyQ3RybCcsdGVtcGxhdGVVcmw6J3JlZ2lzdGVyLmh0bWwnfSlcbiAgICAud2hlbignL2xvZ2luJyx7Y29udHJvbGxlcjonTG9naW5DdHJsJyx0ZW1wbGF0ZVVybDonbG9naW4uaHRtbCd9KVxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uc2VydmljZSgnVXNlclN2YycsZnVuY3Rpb24oJGh0dHApIHtcbiAgICB2YXIgc3ZjID0gdGhpcztcbiAgICBcbiAgICBzdmMuZ2V0VXNlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMnLHtcbiAgICAgICAgICAgaGVhZGVyczp7J1gtQXV0aCc6dGhpcy50b2tlbn1cbiAgICAgICB9KVxuICAgIH1cbiAgICBzdmMubG9naW49ZnVuY3Rpb24gKHVzZXJuYW1lLHBhc3N3b3JkKSB7XG4gICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9zZXNzaW9ucycse1xuICAgICAgICAgICB1c2VybmFtZTp1c2VybmFtZSxwYXNzd29yZDpwYXNzd29yZFxuICAgICAgIH0pIFxuICAgICAgIC50aGVuKGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgICBzdmMudG9rZW4gPSB2YWwuZGF0YVxuICAgICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vbltcIlgtQXV0aFwiXSA9IHZhbC5kYXRhO1xuICAgICAgICAgICByZXR1cm4gc3ZjLmdldFVzZXIoKTtcbiAgICAgICB9KVxuICAgIH1cbiAgICBcbiAgICBzdmMucmVnaXN0ZXIgPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkKSB7XG4gICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvdXNlcnMnLCB7XG4gICAgICB1c2VybmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHN2Yy5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXG4gICAgfSlcbiAgfVxufSkiLCJhbmd1bGFyLm1vZHVsZShcImFwcFwiKVxuLnJ1bihmdW5jdGlvbiAoJHJvb3RTY29wZSwkd2luZG93LCR0aW1lb3V0KSB7XG4gICAgKGZ1bmN0aW9uIGNvbm5lY3QoKXtcbiAgICAgICAgdmFyIGhvc3RcbiAgICAgICAgaWYgKCR3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgPT09IFwiaHR0cHM6XCIpIHtcbiAgICAgICAgICAgIGhvc3QgPSBcIndzczovL1wiICsgJHdpbmRvdy5sb2NhdGlvbi5ob3N0XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBob3N0ID0gXCJ3czovL1wiICsgJHdpbmRvdy5sb2NhdGlvbi5ob3N0XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNvbm5lY3Rpb24gPSBuZXcgV2ViU29ja2V0KGhvc3QpO1xuICAgICAgICBjb25uZWN0aW9uLm9uY2xvc2UgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICBjb25zb2xlLmxvZyhcIldlYlNvY2tldCBjbG9zZWQsUmVjb25uZWN0aW5nLi4uLlwiKTtcbiAgICAgICAgICAgJHRpbWVvdXQoY29ubmVjdCwxMCoxMDAwKTtcbiAgICAgICAgfVxuICAgICAgICBjb25uZWN0aW9uLm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICAgICAgdmFyIHBheWxvYWQgPSBKU09OLnBhcnNlKGUuZGF0YSk7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoXCJ3czpcIitwYXlsb2FkLnRvcGljLHBheWxvYWQuZGF0YSk7XG4gICAgICAgIH1cbiAgICB9KSgpXG59KSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==